CREATE database COMEX;

/* EX 1*/
CREATE TABLE CATEGORIAS(
ID BIGINT auto_increment PRIMARY KEY,
NOME VARCHAR(100));

CREATE TABLE PRODUTOS(
ID BIGINT auto_increment primary KEY,
NOME varchar(225),
PRECO DECIMAL(10,2),
CATEGORIA_ID BIGINT,
FOREIGN KEY (CATEGORIA_ID) REFERENCES CATEGORIAS(ID));

CREATE TABLE CLIENTES(
ID BIGINT auto_increment PRIMARY KEY,
NOME VARCHAR(225));

CREATE TABLE PEDIDOS(
ID BIGINT auto_increment PRIMARY KEY,
DATA datetime,
CLIENTE_ID BIGINT,
FOREIGN KEY (CLIENTE_ID) references CLIENTES(ID));

CREATE TABLE ITEM_PEDIDO(
ID BIGINT auto_increment PRIMARY KEY,
PEDIDO_ID BIGINT,
FOREIGN KEY (PEDIDO_ID) references PEDIDOS(ID),
PRODUTO_ID BIGINT,
FOREIGN KEY (PRODUTO_ID) references PRODUTOS(ID),
PRECO_UNITARIO DECIMAL(10,2),
QUANTIDADE INTEGER);

/* EX 2*/
INSERT INTO CLIENTES(
NOME
) VALUES ('ANA'),('ELI'),('DANI'),('GABI'),('DANI'),('CAIO'),('BIA');

INSERT INTO CATEGORIAS(
NOME
) VALUES ('INFORMATICA'),('MOVEIS'),('LIVROS'),('CELULARES'),('AUTOMOTIVA');

INSERT INTO PRODUTOS(
NOME,
PRECO,
CATEGORIA_ID
) VALUES ('NOTEBOOK SAMSUNG', 3536.00,1),('SOF√Å 3 LUGARES',2500.00,2), ('CLEAN ARCHITETURE', 102.90,3), ('MESA DE JANTAR 6 LUGARES', 3678.98,3),
('IPHONE 13 PRO',9176.00,4),('MONITOR DELL 27',1889.00,1),('IMPLEMENTING DOMAIN-DRIVER DESING',144.07,3),('JOGO DE PNEUS', 1276.79,5),('CLEAN CODE',95.17,3),
('GALAXY S22 ULTRA',8549.10,4),('MACBOOK PRO 16',31752.00,1),('Refactoring Improving the Design of Existing Code',173.90,3),('CAMA QUEEN SIZE',3100.00,2),
('CENTRAL MULTIMIDIA',711.18,5),('BUILDING MICROSERVICE',300.28,3),('GALAXY TAB S8',5939.10,1);

INSERT INTO PEDIDOS(
DATA,
CLIENTE_ID
) VALUES ('2022-01-01',1),('2022-01-05',1),('2022-01-08',2),('2022-01-13',1),('2022-01-04',1),('2022-01-04',3),('2022-01-10',4),('2022-01-15',7),('2022-01-09',7),
('2022-01-14',5),('2022-01-03',6),('2022-01-12',5),('2022-01-07',5),('2022-01-16',6),('2022-01-11',6),('2022-01-02',7);

INSERT INTO ITEM_PEDIDO(
PEDIDO_ID,
PRODUTO_ID,
PRECO_UNITARIO,
QUANTIDADE
) VALUES (65, 1, 3523.00, 1),(66,2,2500.00,1),(67,3,102.90,2),(68,4,3678.98,1),(69,5,9176.00,6),
(70,6,1889.00,3),(71,7,144.07,3),(72,8,1276.79,1),(73,9,95.17,1),(74,10,8549.10,5),(75,11,31752.00,1),
(76,12,173.90,1),(77,13,3100.00,2),(78,14,711.18,1),(79, 15, 300.28,2),(80,16,5949.10,4);
 
 
/* EX 3*/
SELECT
CATEGORIAS.ID AS ID_CATEGORIA,
CATEGORIAS.NOME AS NOME_CATEGORIA,
PRODUTOS.ID AS ID_PRODUTOS,
PRODUTOS.NOME AS NOME_PRODUTO,
PRODUTOS.PRECO AS PRECO_PRODUTO
FROM
CATEGORIAS
INNER JOIN
PRODUTOS ON CATEGORIAS.ID = PRODUTOS.CATEGORIA_ID;


/* EX 4*/

SELECT
    clientes.NOME AS NomeCliente,
    categorias.NOME AS NomeCategoria,
    PRODUTOS.NOME AS NomeProduto,
    item_pedido.PRECO_UNITARIO AS PrecoUnitario,
    item_pedido.QUANTIDADE AS Quantidade,
    pedidos.DATA AS DataPedido
FROM
    CATEGORIAS
INNER JOIN
    PRODUTOS ON categorias.ID = produtos.categoria_id
INNER JOIN
    ITEM_PEDIDO ON produtos.ID = item_pedido.produto_id
INNER JOIN
    pedidos ON item_pedido.PEDIDO_ID = pedidos.ID
INNER JOIN
    clientes ON pedidos.CLIENTE_ID = clientes.ID
    ORDER BY NomeCliente;

/*EX 5*/
SELECT categorias.NOME AS CAT_NOME,
sum(item_pedido.PRECO_UNITARIO * item_pedido.QUANTIDADE) as TOTAL
from categorias
inner join produtos on categorias.id = produtos.CATEGORIA_ID
inner join item_pedido on produtos.ID = item_pedido.PRODUTO_ID
group by categorias.ID, categorias.NOME;

/*EX 6*/
SELECT
count(distinct pedidos.ID) AS QuantidadePedidos,
sum(item_pedido.QUANTIDADE) as QuantidadeProdutosVendidos,
min(item_pedido.PRECO_UNITARIO * item_pedido.QUANTIDADE) as ValorPedidoMaisBarato,
max(item_pedido.PRECO_UNITARIO * item_pedido.QUANTIDADE) as ValorPedidoMaisCaro,
sum(item_pedido.PRECO_UNITARIO * item_pedido.QUANTIDADE) AS MontanteVendido
FROM
    PEDIDOS
INNER JOIN
    ITEM_PEDIDO ON pedidos.ID = item_pedido.PEDIDO_ID;

/*EX 7*/
SELECT
    clientes.NOME AS NomeCliente,
    COUNT(pedidos.ID) AS QuantidadePedidosFeitos
FROM
    CLIENTES
LEFT JOIN
    PEDIDOS ON clientes.ID = pedidos.CLIENTE_ID
GROUP BY
    clientes.ID, clientes.NOME;